{% extends "admin/base_site.html" %}
{% load i18n admin_static admin_list %}
{% load admin_urls %}
{% load rotmicfilters %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "dashboard.css" %}" />
{% endblock %}

{% if not is_popup %}
    {% block breadcrumbs%}<div class="breadcrumbs">
      <a href="../../../">Home</a> &rsaquo;
      <a href="../../">Rotmic</a> &rsaquo;
      <a href="../">Cells</a> &rsaquo;
      {{ o.displayId }}
    </div>
    {% endblock %}
{% endif %}

{% block coltype %}colMS{% endblock %}
{% block bodyclass %}change-list{% endblock %}  {# keeps center scalable #}

{% block title %}Cell {{o.displayId}}{% endblock %} {# window title #}

{% block content %}

<h3>Cell or Strain</h3><h1>{{o}}</h1>



<div id="content-main">

    {% block object-tools %}
    {% if not is_popup %}
      <ul class="object-tools">
        {% block object-tools-items %}
        <li><a href="{% url opts|admin_urlname:'history' o.pk|admin_urlquote %}" class="historylink">{% trans "History" %}</a></li>
        <li><a href="edit">Edit</a></li>
        {% endblock %}
      </ul>
    {% endif %}
    {% endblock %}


    <div class="module" id="sidebar">
    {% block filters %}
        <div id="content-related"> 

            <div class="module" id="recent-actions-module">
                <h2>Rating</h2>
                <p>Not implemented</p>
            </div>
    
            <div class="module" id="recent-actions-module">
                <h2>Classification</h2>
                        <p> 
                        {% with o.componentType as T %}
                            <a href="../?category={{T.category}}">{{T.category}}</a> /<br>
                            <a href="../?category={{T.category}}&type={{T.name}}">{{T.name}}</a>
                        {% endwith %}
                        </p>
            </div>

            <div class="module" id="recent-actions-module">
                <h2>Record</h2>
                <ul>    
                    <li><B>Status</B>:<p> {{o.status}}</p></li>
                    <li><B>registered</B>: 
                        <p>
                        {% with o.registeredBy as U %}
                            {{o.registrationDate}}<br>
                            {{o.registrationTime}}<br>
                            by <a href="../?registeredBy__id__exact={{U.id}}">
                                {{U.first_name}} {{U.last_name}} ({{U}})</a>
                        {% endwith %}
                        </p>
                    </li>
                    {% if o.modifiedBy %}
                        <li><B>last modified</B>: 
                            <p>
                            {% with o.modifiedBy as U %}
                                {{o.modificationDate}}<br>
                                {{o.modificationTime}}<br>
                                by {{U.first_name}} {{U.last_name}} ({{U}})
                            {% endwith %}
                            </p>
                        </li>
                    {% endif %}
                    
                </ul
            </div>
            
        </div> 
                
    {% endblock %}
    </div>

    <h2>Description</h2>
    <div>
        <p class='description'>
            {{o.comment|markdown}}
        </p>
    </div>

    <div style="width: 100%; height: 1px;background: lightgrey; text-align: center;"><h4>Attachments</h3></div>
    <p><br></p>

    <div>
        {% if o.attachments.count != 0 %}
            <table border="0" rules="none">
                <tr>
                    {% for a in o.attachments.all %}
                        <th style="text-align: center;">
                            <a href="{{a.f.url}}">{{a}}</a> <br>
                        </th>
                        <th></th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for a in o.attachments.all %}
                        {% if a.f %}
                            <td style="text-align: center;">{{a.description}} ({{a.f.size|filesizeformat}})</td>
                            <td></td>
                        {% endif %}
                    {% endfor %}
                </tr>
            </table>
        {% else %}
            <div><p>No attachments found.</p></div>
        {% endif %}
        <p></p>
    </div>
</div>

<div class='module'>        
    <h2>DNA features</h2>
    <table>
        <tr>
            {% if o.plasmid %} 
                <th style="text-align: center;">Plasmid</th> <th width="20"></th>
                <th style="text-align: center;">Plasmid Markers</th> <th></th>
            {% endif %}
            {% if o.marker.all %}
                <th style="text-align: center;">Integrated Markers</th> <th></th>
            {% endif %}
        </tr>
        <tr>
            {% if o.plasmid %} 
                {% with plasmid=o.plasmid insert=o.plasmid.insert vector=o.plasmid.vectorBackbone %}
                    <td style="text-align: center;">
                        <a href="{{plasmid.get_absolute_url}}" title="{{plasmid.comment}}">{{plasmid.displayId}}</a>
                        <p>
                            <em>{{plasmid.name}}</em>
                        </p>
                        [{{plasmid.componentType.name}}]
                    </td> <td></td>
                    <td style="text-align: center;">
                        {% if vector.marker.all %}
                            {% for m in vector.marker.all %}
                                <a href="{{m.get_absolute_url}}" title="{{m.comment}}">{{m}}</a><br>
                            {% endfor %}
                        {% endif %}
                    </td> <td></td>
                {% endwith %}
            {% endif %}
            {% if o.marker.all %}
                <td style="text-align: center;">
                    {% for m in o.marker.all %}
                        <a href="{{m.get_absolute_url}}" title="{{m.comment}}">{{m}}</a><br>
                    {% endfor %}
                </td> <td></td>
            {% endif %}
        </tr>            
    </table>
    
    {% if not o.marker and not o.plasmid %}
        <p>There are no DNA modifications described.</p>
    {% endif %}
    
</div>

{% endblock %}

